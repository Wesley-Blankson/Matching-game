<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Term → Definition — Drag & Drop Match</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0b1226; --line:#1d2843; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#22d3ee; --ok:#10b981; --warn:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#000;color:var(--text)}
  header{padding:18px 16px;border-bottom:1px solid var(--line);background:#000;position:sticky;top:0;z-index:10}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:0 0 6px;font-size:22px}
  .sub{margin:0;color:#c9d4ff;font-size:14px;opacity:.9}
  .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:8px}
  .box{border:1px solid #22325a;background:#0b1226;border-radius:10px;padding:6px 10px;font-size:14px}
  button,select{border:1px solid #22325a;background:#0b1226;color:#e5e7eb;border-radius:10px;padding:8px 12px}
  button.primary{background:linear-gradient(90deg,#38bdf8,#22d3ee);color:#001018;border:none;font-weight:800}
  main{padding:8px 0 28px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .col{border:1px solid #22325a;background:#060b18;border-radius:14px;padding:12px}
  .col h2{margin:0 0 8px;font-size:16px;color:#a7b5ff}
  .hint{color:#a8b3c7;font-size:13px;margin-bottom:8px}
  ul{list-style:none;margin:0;padding:0;display:grid;gap:10px}
  .term, .def{
    border:1px solid #22325a;background:#0b1226;border-radius:999px;padding:10px 14px;
    display:flex;align-items:center;min-height:46px;
  }
  .term{cursor:grab;touch-action:none}
  .term:active{cursor:grabbing}
  .def{justify-content:space-between}
  .def .slot{opacity:.9;color:#e5e7eb}
  .def.ready{outline:2px dashed #3a8df2;outline-offset:2px}
  .def.correct{background:rgba(16,185,129,.15);border-color:#14532d}
  .def.miss{animation:shake .18s 2;border-color:#7f1d1d;background:rgba(239,68,68,.06)}
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-3px)}75%{transform:translateX(3px)}100%{transform:translateX(0)}}

  /* Floating drag clone */
  .dragging{
    position:fixed; left:0; top:0; z-index:9999; pointer-events:none;
    border-radius:999px; padding:10px 14px; background:#0b1226; border:1px solid #3a8df2;
    box-shadow:0 10px 24px rgba(0,0,0,.45), 0 0 0 2px rgba(34,211,238,.25) inset;
    transform:translate(-50%,-50%); white-space:nowrap;
  }

  /* Score pulse */
  #score.pulse{animation:scorePulse .36s ease-out}
  @keyframes scorePulse{0%{transform:scale(1)}40%{transform:scale(1.25);color:#5eead4}100%{transform:scale(1)}}

  /* Confetti particles */
  .confetti{position:fixed;pointer-events:none;width:8px;height:8px;border-radius:2px;opacity:.9;will-change:transform,opacity}

  /* Footer */
  .foot{margin-top:14px;color:#94a3b8;font-size:13px;text-align:center}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1 id="topic">Topic</h1>
    <p class="sub">Drag a <b>Term</b> from the left and drop it on the matching <b>Definition</b> on the right.</p>
    <div class="bar">
      <div class="box">Score: <span id="score">0</span></div>
      <div class="box">Matched: <span id="matched">0</span>/<span id="total">0</span></div>
      <select id="setSelect">
        <option value="demo">Demo — Biology</option>
      </select>
      <button id="btnNew" class="primary">New round</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">
      <div class="col">
        <h2>Terms</h2>
        <div class="hint">Drag these</div>
        <ul id="terms"></ul>
      </div>
      <div class="col">
        <h2>Definitions</h2>
        <div class="hint">Drop here</div>
        <ul id="defs"></ul>
      </div>
    </div>
    <p class="foot">✨ Bell + confetti for correct matches. Designed for touch (iPad) and mouse.</p>
  </div>
</main>

<script>
  /* ================== Data (edit here) ================== */
  const SETS = {
    demo: {
      topic: "Cell Biology Basics",
      pairs: [
        ["Mitochondria", "Organelle that produces energy for the cell"],
        ["Osmosis", "Water moving across a semi-permeable membrane"],
        ["Neuron", "A cell that transmits nerve impulses"]
      ]
    }
  };

  /* ================== Audio ================== */
  const matchDing = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3');

  // iOS/Safari: unlock audio on first tap
  function unlockSound(){
    matchDing.play().catch(()=>{}); matchDing.pause(); matchDing.currentTime=0;
    document.removeEventListener('pointerdown', unlockSound);
  }
  document.addEventListener('pointerdown', unlockSound, { once:true });

  /* ================== State / Els ================== */
  let deck = []; // [{term, def, id}]
  let matchedCount = 0;
  let score = 0;

  const topicEl = document.getElementById('topic');
  const termsEl = document.getElementById('terms');
  const defsEl = document.getElementById('defs');
  const scoreEl = document.getElementById('score');
  const matchedEl = document.getElementById('matched');
  const totalEl = document.getElementById('total');
  const setSelect = document.getElementById('setSelect');
  const btnNew = document.getElementById('btnNew');

  /* ================== Utils ================== */
  function uid(){ return 'id_'+Math.random().toString(36).slice(2); }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function centerOf(el){ const r=el.getBoundingClientRect(); return {x:r.left+r.width/2,y:r.top+r.height/2}; }

  // Confetti burst at (x,y)
  function confettiBurst(x, y, count=18){
    const colors=['#5eead4','#22d3ee','#a78bfa','#f472b6','#f59e0b','#10b981'];
    for(let i=0;i<count;i++){
      const p=document.createElement('div'); p.className='confetti';
      p.style.left=x+'px'; p.style.top=y+'px'; p.style.background=colors[(Math.random()*colors.length)|0];
      document.body.appendChild(p);
      const ang=Math.random()*Math.PI*2, dist=40+Math.random()*60;
      const dx=Math.cos(ang)*dist, dy=Math.sin(ang)*dist, rot=(Math.random()*360)|0;
      p.animate([{transform:'translate(0,0) rotate(0deg)',opacity:1},
                 {transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}],
                 {duration:600+Math.random()*400,easing:'cubic-bezier(.2,.8,.2,1)'} );
      setTimeout(()=>p.remove(),1100);
    }
  }
  function pulseScore(){ scoreEl.classList.remove('pulse'); void scoreEl.offsetWidth; scoreEl.classList.add('pulse'); }

  /* ================== Build Round ================== */
  function buildRound(setName){
    const data = SETS[setName];
    topicEl.textContent = data.topic;
    matchedCount = 0; score = 0;
    deck = data.pairs.map(([term, def])=>({id:uid(), term, def}));
    const terms = shuffle([...deck]);            // random order terms
    const defs  = shuffle([...deck]);            // random order defs

    // render
    termsEl.innerHTML=''; defsEl.innerHTML='';
    terms.forEach(item=>{
      const li=document.createElement('li');
      li.className='term'; li.textContent=item.term; li.dataset.id=item.id;
      termsEl.appendChild(li);
      makeDraggable(li);
    });
    defs.forEach(item=>{
      const li=document.createElement('li');
      li.className='def'; li.dataset.id=item.id;
      const label=document.createElement('span'); label.className='slot'; label.textContent=item.def;
      const mark=document.createElement('span'); mark.textContent='⬤'; mark.style.opacity='.25';
      li.appendChild(label); li.appendChild(mark);
      defsEl.appendChild(li);
    });

    matchedEl.textContent = matchedCount;
    totalEl.textContent = deck.length;
    scoreEl.textContent = score;
  }

  /* ================== Drag logic (Pointer events) ================== */
  function makeDraggable(el){
    let dragEl=null, offsetX=0, offsetY=0, originParent=null;

    el.addEventListener('pointerdown', (ev)=>{
      ev.preventDefault();
      el.setPointerCapture(ev.pointerId);
      originParent = el.parentElement;

      const r=el.getBoundingClientRect();
      offsetX = ev.clientX - (r.left + r.width/2);
      offsetY = ev.clientY - (r.top + r.height/2);

      dragEl = document.createElement('div');
      dragEl.className='dragging';
      dragEl.textContent = el.textContent;
      document.body.appendChild(dragEl);
      moveDrag(ev.clientX - offsetX, ev.clientY - offsetY);

      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onUp, { once:true });
    });

    function onMove(ev){
      moveDrag(ev.clientX - offsetX, ev.clientY - offsetY);
      // highlight nearest def under pointer
      const target = defUnderPoint(ev.clientX, ev.clientY);
      document.querySelectorAll('.def').forEach(d=>d.classList.remove('ready'));
      if(target) target.classList.add('ready');
    }

    function onUp(ev){
      document.removeEventListener('pointermove', onMove);
      document.querySelectorAll('.def').forEach(d=>d.classList.remove('ready'));

      const target = defUnderPoint(ev.clientX, ev.clientY);
      if(target){
        const ok = target.dataset.id === el.dataset.id;
        if(ok){
          // lock: show term next to def, mark correct
          target.classList.add('correct');
          target.lastChild.textContent = '✔';
          target.lastChild.style.opacity = '1';

          // effects
          try{ matchDing.currentTime = 0; matchDing.play(); }catch(e){}
          const c = centerOf(target);
          confettiBurst(c.x, c.y);
          score += 10; pulseScore();
          matchedCount += 1;

          // remove draggable to prevent reuse
          el.remove();
          // update HUD
          scoreEl.textContent = score; matchedEl.textContent = matchedCount;

          if(matchedCount === deck.length){
            document.body.animate([{filter:'brightness(1)'},{filter:'brightness(1.1)'},{filter:'brightness(1)'}],{duration:600,iterations:2});
          }
        } else {
          // miss feedback
          target.classList.add('miss');
          setTimeout(()=>target.classList.remove('miss'), 400);
        }
      }
      if(dragEl){ dragEl.remove(); dragEl=null; }
    }

    function moveDrag(x,y){ if(dragEl){ dragEl.style.left=x+'px'; dragEl.style.top=y+'px'; } }

    function defUnderPoint(x,y){
      const els = [...document.querySelectorAll('.def')];
      return els.find(d=>{
        const r=d.getBoundingClientRect();
        return x>=r.left && x<=r.right && y>=r.top && y<=r.bottom && !d.classList.contains('correct');
      }) || null;
    }
  }

  /* ================== Events & Init ================== */
  btnNew.addEventListener('click', ()=> buildRound(setSelect.value));
  setSelect.addEventListener('change', ()=> buildRound(setSelect.value));

  // First load
  buildRound('demo');
</script>
</body>
</html>
